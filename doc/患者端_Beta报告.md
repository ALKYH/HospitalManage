# 患者端 Beta 测试报告

## 1. 概述
覆盖挂号/预约（`/pages/register`、`/pages/book`）、候补管理（`/pages/appointment`）、订单/支付（`/pages/orders`、`/pages/payment`）、登录/个人中心（`/pages/login`、`/pages/profile`）的端到端可用性、表单体验和与后端 API 的交互稳定性验证。

## 2. 测试环境
- 操作系统：Windows/WSL 或 CI 环境
- Node.js：18.x，npm 9.x
- 数据库：MySQL 8.0（或通过 docker-compose 提供）
- 浏览器/小程序环境：Chrome 118 / 微信小程序真机或开发者工具

## 3. 关键测试流程与用例
- 登录/登出：验证 `token` 与 `account_id` 的存储与页面状态同步。
- 挂号流程：科室 → 医生 → 号别 → 时间 → 提交；验证 AI 预填（`aiFormData`）、前端多步校验、后端 `POST /api/registration/create`。
- 预约候补：在 `book` 页测试 `force_waitlist` 标记与跳转行为。
- 候补/订单管理：加载候补列表、状态显示（available/waiting/expired）、取消（含二次确认与乐观回滚）。
- 支付流程：验证 `pages/payment` 的支付查询与模拟支付 `/api/payment/:id/pay`。

## 4. 执行结果摘要
- 登录/注册：通过（Token 与 `account_id` 存储、跳转正确）。
- 挂号/预约提交：通过（主路径成功；付款场景能跳转支付页）。
- 候补列表与取消：通过（UI 与后端交互正常，取消做乐观更新）。
- 支付模拟：通过。 
- 表单体验：部分不通过（少数字段未触发可视高亮，错误提示需统一）。
- 容错与并发：小并发通过；未做大并发压力测试。
- 初始化/健康：部分不通过（`ensure-db` 在 DB 不可用时会抛错，影响本地验证）。

## 5. 评估与建议
- 结论：核心患者流程功能完整可用，需修复表单 UX 与增强后端在 DB 不可用时的容错能力。

### 改进建议（通过项后）
1. 统一表单校验样式并确保所有必填字段高亮（责任：前端；期限：3 个工作日）。
2. 增加 E2E 覆盖挂号→支付→订单流（责任：测试；期限：2 周）。

### 整改建议（不通过项）
1. 表单高亮缺失：修复校验绑定并补充 E2E（责任：前端；期限：3 天）。
2. `ensure-db` 容错：在 `scripts/ensure_db.js` 中加入重试/退避并在 `docker-compose.yml` 添加 `healthcheck`（责任：后端+DevOps；期限：4 天）。
3. 友好错误：后端统一返回 4xx+用户友好消息，前端只展示摘要（责任：后端；期限：3 天）。

## 6. 责任划分（建议）
- 前端：表单 UX、错误展示、E2E 覆盖。 
- 后端：错误统一、`ensure-db` 容错。 
- 测试：自动化回归覆盖关键路径。
