# 医生端 Beta 测试报告

## 1. 概述
覆盖医生登录与会话（`/pages/docLogin`）、医生管理与操作（`/pages/docIndex`、`/pages/docRegister`、`/pages/docShift`、`/pages/docPick`、`/pages/docProfile`、`/pages/docInfo`、`/pages/docAbsence`、`/pages/docAccount`）的可用性、权限与数据一致性验证。

## 2. 测试环境
- 操作系统：Windows/WSL 或 CI 环境
- Node.js：18.x，npm 9.x
- 数据库：MySQL 8.0（或 docker-compose 提供）
- 小程序环境：微信开发者工具/真机

## 3. 关键测试流程与用例
- 医生登录：`/auth/login` + `/api/doctor/me`，验证 `doctor_id` 与 `doctor` 缓存；跳转 `/pages/docIndex`。
- 医生资料管理：创建/编辑资料并提交审核。
- 排班管理：新增/编辑班次、冲突校验与后端返回处理。
- 接诊/取号：处理候补、标记接诊、缺勤管理。
- 审核/审计：提交审核与查看审计记录。

## 4. 执行结果摘要
- 医生登录：通过（缓存 `doctor_id`，跳转正常）。
- 医生资料/注册：通过（创建与提交审核记录）。
- 排班管理：部分不通过（边界冲突时后端返回 500，前端未做充分本地预检）。
- 接诊/取号：通过（记录写入后端）。
- 审核与审计：通过（记录可查询）。
- 权限隔离：通过（未登录/非医生权限受限）。

## 5. 评估与建议
- 结论：医生端核心功能可用，但排班冲突处理为高风险点，需优先修复。

### 改进建议（通过项后）
1. 前端在提交排班前做本地冲突预检并提示（责任：前端；期限：3 天）。
2. 在重要操作增加确认/回滚机制（责任：前端；期限：1 周）。
3. 增加审计日志可视化页面（责任：后端+前端；期限：2 周）。

### 整改建议（不通过项）
1. 排班冲突导致 500：后端捕获冲突并返回 4xx+冲突详情；前端展示并提供调整建议（责任：后端+前端；期限：3 天）。
2. `/api/doctor/me` 超时或失败不应阻塞登录跳转：改为非阻塞获取并重试（责任：前端；期限：2 天）。

## 6. 责任划分（建议）
- @后端：修复排班异常处理、返回结构化错误、支持审计。 
- @前端：预检排班冲突、非阻塞 `doctor/me` 调用、改进 UX。 
- @测试：补充医生端 E2E 回归（排班/接诊/缺勤/审核）。
