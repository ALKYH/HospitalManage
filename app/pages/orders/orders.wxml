<view class="container">

<view class="message" wx:if="{{message}}">
  {{message}}
</view>

<scroll-view scroll-x enable-flex="true" class="tab-bar">
  <view class="tab-list">
    <view 
      wx:for="{{tabs}}" 
      wx:key="key" 
      data-key="{{item.key}}" 
      bindtap="changeTab"
      class="tab-item {{activeTab === item.key ? 'active' : ''}}"
    >
      <text>{{item.name}}</text>
      <text class="tab-count" wx:if="{{item.count > 0}}">{{item.count}}</text>
    </view>
  </view>
</scroll-view>

<block wx:for="{{filteredOrders}}" wx:for-item="item" wx:key="id">
  <view class="order-item" style="border-left-color: {{item.statusColor}};">
    
    <view class="order-header">
      <view class="order-status-tag" style="background-color: {{item.statusBg}}; color: {{item.statusColor}};">
        {{item.displayStatus}}
      </view>
      <view class="order-id">è®¢å•ID: {{item.id}}</view>
    </view>

    <view class="main-info">
      <view class="doctor-name">ğŸ‘¨â€âš•ï¸ {{item.doctor_id}}</view>
      <view class="appointment-time">
        ğŸ“… {{item.date}}
        <text class="time-slot">{{item.slot}}</text>
      </view>
    </view>

    <view class="divider"></view>

    <view class="detail-row">
      <text class="detail-label">è´¹ç”¨:</text>
      <text class="detail-value" wx:if="{{item.payment_id}}">
        Â¥{{item.payment_amount}} 
        <text wx:if="{{item.isPaid}}" class="paid-time"> ({{item.payment_paid_at ? 'å·²æ”¯ä»˜' : 'å·²æ”¯ä»˜'}})</text>
        <text wx:elif="{{item.isUnpaid}}" class="unpaid-notice"> (å¾…ä»˜æ¬¾)</text>
      </text>
      <text class="detail-value" wx:else>æ— éœ€æ”¯ä»˜/å·²åŒ…å«</text>
    </view>

    <view class="detail-row" wx:if="{{item.isWaitlist}}">
      <text class="detail-label">å€™è¡¥ä¿¡æ¯:</text>
      <text class="detail-value waitlist-position">
        å½“å‰ä½ç½®: {{item.wait_position + 1}} / {{item.wait_total}}
      </text>
    </view>

    <view class="order-actions">
      <button 
        wx:if="{{item.isUnpaid}}" 
        class="action-button primary-action" 
        bindtap="onPay" 
        data-id="{{item.payment_id}}"
      >
        ç«‹å³æ”¯ä»˜
      </button>
      
      <button 
        wx:if="{{!item.isCancelled && !item.isCompleted && (item.isPaid || item.isWaitlist)}}" 
        class="action-button secondary-action" 
        bindtap="onCancel" 
        data-id="{{item.id}}"
      >
        {{item.isWaitlist ? 'å–æ¶ˆå€™è¡¥' : 'å–æ¶ˆé¢„çº¦'}}
      </button>
    </view>

  </view>
</block>

<view class="empty-state" wx:if="{{!filteredOrders || filteredOrders.length === 0 && !message}}">
  <text>å½“å‰åˆ†ç±»æš‚æ— è®¢å•</text>
</view>

</view>