<view class="container">
  <view class="bg-blob blob-1"></view>
  <view class="bg-blob blob-2"></view>

  <view wx:if="{{message}}" class="global-msg fade-in">
    <icon type="warn" size="16" color="#f56c6c"></icon>
    <text>{{message}}</text>
  </view>

  <view wx:if="{{loading}}" class="skeleton-container">
    <block wx:for="{{[1,2,3]}}" wx:key="*this">
      <view class="skeleton-card shimmer">
        <view class="sk-header"></view>
        <view class="sk-body"></view>
        <view class="sk-footer"></view>
      </view>
    </block>
  </view>

  <block wx:else>
    <view class="list-container">
      
      <block wx:for="{{ordersList}}" wx:key="id">
        <view class="card {{item.view.isActionable ? 'card-active' : ''}} slide-up" style="animation-delay: {{index * 0.1}}s">
          
          <view class="card-header">
            <view class="doctor-info">
              <view class="doctor-name">{{item.view.doctorName}}</view>
              <view class="dept-name" wx:if="{{item.view.deptName}}">{{item.view.deptName}}</view>
            </view>
            <view class="status-badge" style="background: {{item.view.badgeBg}}; color: {{item.view.badgeColor}}">
              {{item.view.statusText}}
            </view>
          </view>

          <view class="divider"></view>

          <view class="card-body">
            <view class="info-row">
              <text class="label">é¢„çº¦æ—¥æœŸ</text>
              <text class="value date-text">{{item.date}}</text>
            </view>
            <view class="info-row">
              <text class="label">æ—¶æ®µ</text>
              <text class="value slot-text">{{item.slot}}</text>
            </view>
            <view class="info-row" wx:if="{{item.is_waitlist && !item.view.isActionable}}">
               <text class="label">å½“å‰æ’ä½</text>
               <text class="value wait-text">ç¬¬ {{item.wait_position + 1}} ä½</text>
            </view>
          </view>

          <view class="card-footer">
            <block wx:if="{{item.view.isActionable}}">
              <view class="action-tip">ğŸ‘ æ­å–œï¼Œç°åœ¨å¯ä»¥æŒ‚å·äº†ï¼</view>
              <button class="btn btn-primary pulse-anim" data-orderid="{{item.id}}" bindtap="onGoRegister">
                ç«‹å³æŒ‚å·
              </button>
            </block>
            
            <block wx:else>
              <button class="btn btn-ghost" data-orderid="{{item.id}}" bindtap="onCancel" wx:if="{{item.status!=='expired'}}">
                å–æ¶ˆå€™è¡¥
              </button>
              <view wx:else class="expired-tip">å·²æ— æ³•æ“ä½œ</view>
            </block>
          </view>

        </view>
      </block>

      <view wx:if="{{!ordersList || ordersList.length === 0}}" class="empty-state fade-in">
        <image class="empty-img" src="https://img.icons8.com/bubbles/200/calendar.png" mode="aspectFit"></image>
        <text>æš‚æ— å€™è¡¥è®°å½•</text>
      </view>

    </view>
  </block>
</view>