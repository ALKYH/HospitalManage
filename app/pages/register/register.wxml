<view class="container">
    <view class="header">
    <text class="main-title">智能挂号服务</text>
    <text class="sub-title">请按步骤完成挂号信息选择</text>
  </view>

    <view class="card {{currentStep === 1 ? 'active' : ''}}" data-step="1">
    <view class="card-header">
      <view class="step-badge step-1">1</view>
      <text class="card-title">选择科室</text>
    </view>
    <view class="card-content">
      <view class="picker-group">
        <view class="picker-display selected-label">{{selectedDept.name || '请选择科室'}}</view>
        <button class="action-btn" bindtap="goToDepartment">立即选择科室</button>
      </view>
    </view>
  </view>

    <view class="card {{currentStep === 2 ? 'active' : ''}}" data-step="2">
    <view class="card-header">
      <view class="step-badge step-2">2</view>
      <text class="card-title">选择医生</text>
    </view>
    <view class="card-content">
      <picker mode="selector" range="{{doctors}}" range-key="name" value="{{selectedDoctor.id ? -1 : 0}}" bindchange="onDoctorChange" disabled="{{currentStep < 2 || doctors.length === 0}}">
        <view class="picker-display {{!selectedDoctor.id && selectedDoctor !== '请选择医生' ? 'disabled-text' : ''}}">
          {{selectedDoctor.name || '请选择医生'}}
        </view>
      </picker>
      <text wx:if="{{selectedDept.id && doctors.length === 0}}" class="tip-text">该科室暂无医生排班</text>
    </view>
  </view>

    <view class="card {{currentStep === 3 ? 'active' : ''}}" data-step="3">
    <view class="card-header">
      <view class="step-badge step-3">3</view>
      <text class="card-title">选择号别与查询号源</text>
    </view>
    <view class="card-content">
      <picker mode="selector" range="{{registerRange}}" value="{{registerRange.indexOf(selectedRegi)}}" bindchange="onRegiChange" disabled="{{currentStep < 3}}">
        <view class="picker-display">{{selectedRegi || '请选择号别'}}</view>
      </picker>
      <block wx:if="{{availableTypesList && availableTypesList.length}}">
        <view class="types-container">
          <text class="sub-note">未来可用号源总计：</text>
          <view class="types">
            <block wx:for="{{availableTypesList}}" wx:key="type">
              <view class="type-item {{item.type === selectedRegiKey ? 'type-active' : ''}}">
                {{item.type}}:<text class="count-num">{{item.count}}</text>
              </view>
            </block>
          </view>
        </view>
      </block>
      <text wx:else class="tip-text">请先选择医生以查询号源情况</text>
    </view>
  </view>

    <view class="card {{currentStep === 4 ? 'active' : ''}}" data-step="4">
    <view class="card-header">
      <view class="step-badge step-4">4</view>
      <text class="card-title">选择就诊日期与时段</text>
    </view>
    <view class="card-content">
        <register-date-picker 
          availability="{{availability}}" 
          regiType="{{selectedRegiKey}}" 
          bind:timeSelected="onTimeSelected" 
        />
    </view>
  </view>

    <button class="register-btn {{selectedDate && selectedSlot ? 'ready' : ''}}" bindtap="register">
    {{selectedDate && selectedSlot ? '确认并立即挂号' : '请完成以上选择'}}
  </button>

    <view wx:if="{{message}}" class="message">{{message}}</view>
</view>