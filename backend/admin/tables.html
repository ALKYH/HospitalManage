<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>DB Tables - Admin Debug</title>
  <style>
    .table-wrap{overflow:auto}
  </style>
  <!-- 现代化样式：Pico.css（自动支持明暗色） -->
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2/css/pico.min.css">
  <!-- 使用 Vue 3 CDN 版本 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- 可选：为兼容旧浏览器的 fetch（若后端部署环境需要）-->
  <!-- <script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3.6.20/dist/fetch.umd.min.js"></script> -->
  
</head>
<body>
  <header class="container">
    <nav>
      <ul>
        <li><strong>Database Tables (Debug)</strong></li>
      </ul>
      <ul>
        <li><button id="themeToggle" class="secondary">切换主题</button></li>
      </ul>
    </nav>
  </header>
  <main class="container">
  <div id="app">
    <div v-if="loading">加载中...</div>
    <div v-else>
      <div id="info">{{ infoText }}</div>
      <div v-if="message" style="color:#c00;margin:8px 0">{{ message }}</div>
      <div class="table-wrap">
      <table id="tbl" class="striped">
        <thead>
          <tr>
            <th>Table Name</th>
            <th>Rows (estimate)</th>
            <th>Engine</th>
            <th>Type</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="r in rows" :key="r.TABLE_NAME">
            <td>{{ r.TABLE_NAME }}</td>
            <td>{{ r.TABLE_ROWS }}</td>
            <td>{{ r.ENGINE || '' }}</td>
            <td>{{ r.TABLE_TYPE || '' }}</td>
          </tr>
          <tr v-if="rows.length===0">
            <td colspan="4" style="text-align:center;color:#888">无数据</td>
          </tr>
        </tbody>
      </table>
      </div>
    </div>
  </div>

  <script>
    const { createApp, onMounted, ref } = Vue;

    createApp({
      setup(){
        const loading = ref(true);
        const message = ref('');
        const infoText = ref('');
        const rows = ref([]);

        const fetchTables = async () => {
          const token = localStorage.getItem('admin_token');
          const headers = token ? { 'Authorization': 'Bearer ' + token } : {};
          try {
            const res = await fetch('/api/admin/tables', { headers });
            if (res.status === 401) {
              message.value = 'Unauthorized - 请以管理员身份登录';
              infoText.value = '';
              rows.value = [];
              return;
            }
            const data = await res.json();
            if (!data.success) {
              message.value = 'Error: ' + (data.message || JSON.stringify(data));
              infoText.value = '';
              rows.value = [];
              return;
            }
            message.value = '';
            infoText.value = 'Database: ' + (data.database || 'unknown');
            rows.value = Array.isArray(data.data) ? data.data : [];
          } catch (e) {
            message.value = 'Fetch error: ' + e.message;
            infoText.value = '';
            rows.value = [];
          } finally {
            loading.value = false;
          }
        };

        onMounted(()=>{
          // theme init
          const saved = localStorage.getItem('theme');
          const t = saved || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
          document.documentElement.setAttribute('data-theme', t);
          fetchTables();
        });
        return { loading, message, infoText, rows };
      }
    }).mount('#app');

    // theme toggle button
    const btn = document.getElementById('themeToggle');
    if(btn){
      btn.addEventListener('click', ()=>{
        const cur = document.documentElement.getAttribute('data-theme') || 'light';
        const next = cur==='light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      });
    }
  </script>
  </main>
</body>
</html>